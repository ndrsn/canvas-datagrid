name: Publish documentation

on: workflow_dispatch

jobs:
  publish-documentation:
      name: Publish documentation
      runs-on: ubuntu-latest

      strategy:
        matrix:
          node-version: [14.x]

      steps:
        - name: Checkout
          uses: actions/checkout@v2
        - name: Install Node
          uses: actions/setup-node@v1
          with:
            node-version: '14.x'
        - name: Install dependencies
          run: npm ci
        - name: Build debug version
          run: npm run build
        - name: Build documentation
          run: npm run build-docs
        # Copying manually, because the gh-pages actions
        # ignores everything listed in .gitignore, which
        # includes the dist/ directory, meaning files there
        # will not be published along with the rest of the docs
        - name: Make library available to docs
          run: cp dist/canvas-datagrid.debug.js docs/
        # This will make documentation available at
        # https://<username>.github.io/canvas-datagrid/docs/
        - name: Publish documentation to GitHub pages
          uses: peaceiris/actions-gh-pages@v3.7.0-8
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            exclude_assets: '.gitignore,.github'
            publish_dir: .
